!function(){function e(e){return e}var n={NEXT:"next",NEXT_UNIQUE:"nextunique",PREV:"prev",PREV_UNIQUE:"prevunique"},o={READONLY:"readonly",READWRITE:"readwrite"},t={exposed:["clearTable","deleteDb","insertDoc","insertDocs","getById","getAllDocs","getDocsEquals","getDocsLessThan","getDocsGreaterThan","getDocsRange","updateAllDocs","updateDocsEquals","updateDocsLessThan","updateDocsGreaterThan","updateDocsRange","deleteDoc","deleteDocs","deleteAllDocs","deleteDocsEquals","deleteDocsLessThan","deleteDocsGreaterThan","deleteDocsRange"],addCommonMethods:function(e,n){e.onerror=function(e){n(e,!0)},e.oncomplete=function(e){n(e)},e.onsuccess=function(e){n(e)},e.onabort=function(e){n(e,!0)}},query:function(a,r,s,c,u,i,d,l,D){var f=a.transaction(s,c||o.READONLY),v=f.objectStore(s);d=void 0===d?null:d,u=u||n.NEXT,D=D||e,l=l||e,t.addCommonMethods(f,r),f.oncomplete=function(e){r(D(e))},i&&(v=v.index(i)),v=v.openCursor(d,u),v.onsuccess=function(e){var n=e.target.result;n&&(l(n),n["continue"]())}},queryWithClause:function(e,n,o,r,s,c,u,i,d){var l,D=a.window.IDBKeyRange,f={"<":"upperBound",">":"lowerBound","=":"only","<>":"bound"};if(u){var v=u.values,p=u.inclusive||[!0,!0],g=f[u.operator];l="<>"==u.operator?D[g](v[0],v[1],!p[0],!p[1]):D[g](v[0],!p[0])}t.query(e,n,o,r,s,c,l,i,d)},getDocsBase:function(a,r,s,c,u){function i(n){var o=e(n.value);o&&f.push(n.value)}function d(e){return f}var l=o.READONLY,D=n.NEXT,f=[];t.queryWithClause(a,r,s,l,D,c,u,i,d)},getAllDocs:function(e,n,o){t.getDocsBase(e,n,o)},getDocsEquals:function(e,n,o,a,r){t.getDocsBase(e,n,o,a,{operator:"=",values:[r]})},getDocsLessThan:function(e,n,o,a,r,s){t.getDocsBase(e,n,o,a,{operator:"<",values:[r],inclusive:[s]})},getDocsGreaterThan:function(e,n,o,a,r,s){t.getDocsBase(e,n,o,a,{operator:">",values:[r],inclusive:[s]})},getDocsRange:function(e,n,o,a,r,s,c,u){t.getDocsBase(e,n,o,a,{operator:"<>",values:[r,s],inclusive:[c,u]})},getById:function(e,n,a,r){var s=e.transaction(a,o.READWRITE),c=s.objectStore(a),u=c.get(r);t.addCommonMethods(s,n),s.oncomplete=function(e){n(u.result)}},updateDocsBase:function(e,a,r,s,c,u){function i(e){s(e.value),e.update(e.value),f.push(e.value)}function d(e){return f}var l=o.READWRITE,D=n.NEXT,f=[];t.queryWithClause(e,a,r,l,D,c,u,i,d)},updateAllDocs:function(e,n,o,a){t.updateDocsBase(e,n,o,a)},updateDocsEquals:function(e,n,o,a,r,s){t.updateDocsBase(e,n,o,s,a,{operator:"=",values:[r]})},updateDocsLessThan:function(e,n,o,a,r,s,c){t.updateDocsBase(e,n,o,s,a,{operator:"<",values:[r],inclusive:[c]})},updateDocsGreaterThan:function(e,n,o,a,r,s,c){t.updateDocsBase(e,n,o,s,a,{operator:">",values:[r],inclusive:[c]})},updateDocsRange:function(e,n,o,a,r,s,c,u,i){t.updateDocsBase(e,n,o,c,a,{operator:"<>",values:[r,s],inclusive:[u,i]})},insertDoc:function(e,n,a,r){var s=e.transaction(a,o.READWRITE),c=s.objectStore(a);t.addCommonMethods(s,n),c.put(r)},insertDocs:function(e,n,a,r){var s=e.transaction(a,o.READWRITE),c=s.objectStore(a);t.addCommonMethods(s,n);for(var u=0;u<r.length;u++){var i=r[u];c.put(i)}},deleteDocs:function(e,n,a,r,s){function c(e){var n="object"==typeof e;if(n){var o=s||"id";return e[o]}return e}var u=e.transaction(a,o.READWRITE),i=u.objectStore(a);t.addCommonMethods(u,n);for(var d=0;d<r.length;d++){var l=c(r[d]);i["delete"](l)}},deleteDoc:function(e,n,o,a,r){t.deleteDocs(e,n,o,[a],r)},deleteDocsBase:function(e,a,r,s,c){function u(e){D.push(e.value),e["delete"]()}function i(e){return D}var d=o.READWRITE,l=n.NEXT,D=[];t.queryWithClause(e,a,r,d,l,s,c,u,i)},deleteAllDocs:function(e,n,o,a){t.deleteDocsBase(e,n,o,a)},deleteDocsEquals:function(e,n,o,a,r){t.deleteDocsBase(e,n,o,a,{operator:"=",values:[r]})},deleteDocsLessThan:function(e,n,o,a,r,s){t.deleteDocsBase(e,n,o,a,{operator:"<",values:[r],inclusive:[s]})},deleteDocsGreaterThan:function(e,n,o,a,r,s){t.deleteDocsBase(e,n,o,a,{operator:">",values:[r],inclusive:[s]})},deleteDocsRange:function(e,n,o,a,r,s,c,u){t.deleteDocsBase(e,n,o,a,{operator:"<>",values:[r,s],inclusive:[c,u]})},deleteDb:function(e,n){e.close();var o=a.window.indexedDB.deleteDatabase(e.name);o.onerror=function(e){a.reset(),n(!1,!0)},o.onsuccess=function(e){n(!0)}},clearTable:function(e,n,a){var r=e.transaction(a,o.READWRITE),s=r.objectStore(a);t.addCommonMethods(r,n),s.clear()}},a={window:void 0,reset:function(){a.promise=void 0,a.window=void 0},promise:void 0,promiseWrapper:function(e,n){var o=e.defer();return a.promise.then(function(e){n(e,function(e,n){n?o.reject(e):o.resolve(e)})}),o.promise},createDatabase:function(e,n,o,t,r){a.window=e;var s=n.defer();a.promise=s.promise,"indexedDB"in e||(e.indexedDB=e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB),"IDBTransaction"in e||(e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction||e.msIDBTransaction),"IDBKeyRange"in e||(e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange||e.msIDBKeyRange);var c=e.indexedDB.open(o,t);c.onsuccess=function(e){var n=e.target.result;s.resolve(n)},c.onblocked=function(){},c.onerror=function(){},c.onupgradeneeded=function(e){for(var n=e.target.result,o=0;o<r.length;o++){var t,a=r[o];t=n.objectStoreNames.contains(a.name)?e.currentTarget.transaction.objectStore(a.name):n.createObjectStore(a.name,{keyPath:a.keyPath,unique:!0});for(var s=0;s<t.indexNames.length;s++){var c=t.indexNames[s];a.indexes.indexOf(c)<0&&t.deleteIndex(c,c,{unique:!1})}for(var u=0;u<a.indexes.length;u++){var c=a.indexes[u];t.indexNames.contains(c)||t.createIndex(c,c,{unique:!1})}}}},wrapDbMethods:function(e){for(var n={},o=t.exposed,r=0;r<o.length;r++)!function(){var s=o[r];n[s]=function(n,o,r,c,u,i,d,l,D,f,v){return a.promiseWrapper(e,function(e,a){var p=t[s];p(e,a,n,o,r,c,u,i,d,l,D,f,v)})}}();return n},init:function(e,n,o,t,r){return a.createDatabase(e,n,o,t,r),a.wrapDbMethods(n)}},r=angular.module("veen.db",[]);r.factory("indexedDB",["$window","$q",function(e,n){var o={init:function(o,t,r){return a.init(e,n,o,t,r)}};return o}])}();