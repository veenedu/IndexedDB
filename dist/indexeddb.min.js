!function(){function e(e){return e}var n=angular.module("veen.db",[]),o={NEXT:"next",NEXT_UNIQUE:"nextunique",PREV:"prev",PREV_UNIQUE:"prevunique"},t={READONLY:"readonly",READWRITE:"readwrite"},a={exposed:["clearTable","deleteDb","insertDoc","insertDocs","getById","getAllDocs","getDocsEquals","getDocsLessThan","getDocsGreaterThan","getDocsRange","updateAllDocs","updateDocsEquals","updateDocsLessThan","updateDocsGreaterThan","updateDocsRange","deleteDoc","deleteDocs","deleteAllDocs","deleteDocsEquals","deleteDocsLessThan","deleteDocsGreaterThan","deleteDocsRange"],addCommonMethods:function(e,n){e.onerror=function(e){n(e,!0)},e.oncomplete=function(e){n(e)},e.onsuccess=function(e){n(e)},e.onabort=function(e){n(e,!0)}},query:function(n,r,s,c,u,i,d,l,D){var f=n.transaction(s,c||t.READONLY),v=f.objectStore(s);d=void 0===d?null:d,u=u||o.NEXT,D=D||e,l=l||e,a.addCommonMethods(f,r),f.oncomplete=function(e){r(D(e))},i&&(v=v.index(i)),v=v.openCursor(d,u),v.onsuccess=function(e){var n=e.target.result;n&&(l(n),n["continue"]())}},queryWithClause:function(e,n,o,t,s,c,u,i,d){var l,D=r.window.IDBKeyRange,f={"<":"upperBound",">":"lowerBound","=":"only","<>":"bound"};if(u){var v=u.values,p=u.inclusive||[!0,!0],g=f[u.operator];l="<>"==u.operator?D[g](v[0],v[1],!p[0],!p[1]):D[g](v[0],!p[0])}a.query(e,n,o,t,s,c,l,i,d)},getDocsBase:function(n,r,s,c,u){function i(n){var o=e(n.value);o&&f.push(n.value)}function d(e){return f}var l=t.READONLY,D=o.NEXT,f=[];a.queryWithClause(n,r,s,l,D,c,u,i,d)},getAllDocs:function(e,n,o){a.getDocsBase(e,n,o)},getDocsEquals:function(e,n,o,t,r){a.getDocsBase(e,n,o,t,{operator:"=",values:[r]})},getDocsLessThan:function(e,n,o,t,r,s){a.getDocsBase(e,n,o,t,{operator:"<",values:[r],inclusive:[s]})},getDocsGreaterThan:function(e,n,o,t,r,s){a.getDocsBase(e,n,o,t,{operator:">",values:[r],inclusive:[s]})},getDocsRange:function(e,n,o,t,r,s,c,u){a.getDocsBase(e,n,o,t,{operator:"<>",values:[r,s],inclusive:[c,u]})},getById:function(e,n,o,r){var s=e.transaction(o,t.READWRITE),c=s.objectStore(o),u=c.get(r);a.addCommonMethods(s,n),s.oncomplete=function(e){n(u.result)}},updateDocsBase:function(e,n,r,s,c,u){function i(e){s(e.value),e.update(e.value),f.push(e.value)}function d(e){return f}var l=t.READWRITE,D=o.NEXT,f=[];a.queryWithClause(e,n,r,l,D,c,u,i,d)},updateAllDocs:function(e,n,o,t){a.updateDocsBase(e,n,o,t)},updateDocsEquals:function(e,n,o,t,r,s){a.updateDocsBase(e,n,o,s,t,{operator:"=",values:[r]})},updateDocsLessThan:function(e,n,o,t,r,s,c){a.updateDocsBase(e,n,o,s,t,{operator:"<",values:[r],inclusive:[c]})},updateDocsGreaterThan:function(e,n,o,t,r,s,c){a.updateDocsBase(e,n,o,s,t,{operator:">",values:[r],inclusive:[c]})},updateDocsRange:function(e,n,o,t,r,s,c,u,i){a.updateDocsBase(e,n,o,c,t,{operator:"<>",values:[r,s],inclusive:[u,i]})},insertDoc:function(e,n,o,r){var s=e.transaction(o,t.READWRITE),c=s.objectStore(o);a.addCommonMethods(s,n),c.put(r)},insertDocs:function(e,n,o,r){var s=e.transaction(o,t.READWRITE),c=s.objectStore(o);a.addCommonMethods(s,n);for(var u=0;u<r.length;u++){var i=r[u];c.put(i)}},deleteDocs:function(e,n,o,r,s){function c(e){var n="object"==typeof e;if(n){var o=s||"id";return e[o]}return e}var u=e.transaction(o,t.READWRITE),i=u.objectStore(o);a.addCommonMethods(u,n);for(var d=0;d<r.length;d++){var l=c(r[d]);i["delete"](l)}},deleteDoc:function(e,n,o,t,r){a.deleteDocs(e,n,o,[t],r)},deleteDocsBase:function(e,n,r,s,c){function u(e){D.push(e.value),e["delete"]()}function i(e){return D}var d=t.READWRITE,l=o.NEXT,D=[];a.queryWithClause(e,n,r,d,l,s,c,u,i)},deleteAllDocs:function(e,n,o,t){a.deleteDocsBase(e,n,o,t)},deleteDocsEquals:function(e,n,o,t,r){a.deleteDocsBase(e,n,o,t,{operator:"=",values:[r]})},deleteDocsLessThan:function(e,n,o,t,r,s){a.deleteDocsBase(e,n,o,t,{operator:"<",values:[r],inclusive:[s]})},deleteDocsGreaterThan:function(e,n,o,t,r,s){a.deleteDocsBase(e,n,o,t,{operator:">",values:[r],inclusive:[s]})},deleteDocsRange:function(e,n,o,t,r,s,c,u){a.deleteDocsBase(e,n,o,t,{operator:"<>",values:[r,s],inclusive:[c,u]})},deleteDb:function(e,n){e.close();var o=r.window.indexedDB.deleteDatabase(e.name);o.onerror=function(e){r.reset(),n(!1,!0)},o.onsuccess=function(e){n(!0)}},clearTable:function(e,n,o){var r=e.transaction(o,t.READWRITE),s=r.objectStore(o);a.addCommonMethods(r,n),s.clear()}},r={window:void 0,reset:function(){r.promise=void 0,r.window=void 0},promise:void 0,promiseWrapper:function(e,n){var o=e.defer();return r.promise.then(function(e){n(e,function(e,n){n?o.reject(e):o.resolve(e)})}),o.promise},createDatabase:function(e,n,o,t,a){r.window=e;var s=n.defer();r.promise=s.promise,"indexedDB"in e||(e.indexedDB=e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB),"IDBTransaction"in e||(e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction||e.msIDBTransaction),"IDBKeyRange"in e||(e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange||e.msIDBKeyRange);var c=e.indexedDB.open(o,t);c.onsuccess=function(e){var n=e.target.result;s.resolve(n)},c.onblocked=function(){},c.onerror=function(){},c.onupgradeneeded=function(e){for(var n=e.target.result,o=0;o<a.length;o++){var t,r=a[o];t=n.objectStoreNames.contains(r.name)?e.currentTarget.transaction.objectStore(r.name):n.createObjectStore(r.name,{keyPath:r.keyPath,unique:!0});for(var s=0;s<t.indexNames.length;s++){var c=t.indexNames[s];r.indexes.indexOf(c)<0&&t.deleteIndex(c,c,{unique:!1})}for(var u=0;u<r.indexes.length;u++){var c=r.indexes[u];t.indexNames.contains(c)||t.createIndex(c,c,{unique:!1})}}}},wrapDbMethods:function(e){for(var n={},o=a.exposed,t=0;t<o.length;t++)!function(){var s=o[t];n[s]=function(n,o,t,c,u,i,d,l,D,f,v){return r.promiseWrapper(e,function(e,r){var p=a[s];p(e,r,n,o,t,c,u,i,d,l,D,f,v)})}}();return n},init:function(e,n,o,t,a){return r.createDatabase(e,n,o,t,a),r.wrapDbMethods(n)}};n.factory("indexedDB",["$window","$q",function(e,n){var o={init:function(o,t,a){return r.init(e,n,o,t,a)}};return o}])}();